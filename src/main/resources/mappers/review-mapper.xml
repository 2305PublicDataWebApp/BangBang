<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ReviewMapper">
	<resultMap type="Review" id="ReviewResultMap">
		<id property="reviewNo" column="REVIEW_NO" />
		<result property="reiviewType" column="REVIEW_TYPE" />
		<result property="reviewTitle" column="REVIEW_TITLE" />
		<result property="reviewContent" column="REVIEW_CONTENT" />
		<result property="rUserId" column="R_USER_ID" />
		<result property="reviewDate" column="REVIEW_DATE" />
		<result property="reviewViewcount" column="REVIEW_VIEWCOUNT" />
		<result property="rStatusYn" column="R_STATUS_YN" />
		<result property="rAdminId" column="R_ADMIN_ID" />
	</resultMap>
	
	<insert id="insertReview">
		INSERT INTO REVIEW_BOARD VALUES(SEQ_REVIEW_NO.NEXTVAL, #{reiviewType }, #{reviewTitle }, #{reviewContent }, #{rUserId }, DEFAULT, 0, DEFAULT, NULL)
	</insert>
	
	<update id="modifyReview">
		UPDATE REVIEW_BOARD SET REVIEW_TYPE = #{reiviewType}, REVIEW_TITLE = #{reviewTitle}, REVIEW_CONTENT = #{reviewContent} WHERE REVIEW_NO = {reviewNo}
	</update>
	
	<update id="deleteReview">
		UPDATE REVIEW_BOARD SET R_STATUS_YN = 'N' WHERE REVIEW_NO = #{reviewNo } AND [R_USER_ID = #{rUserId } OR R_ADMIN_ID = #{rAdminId }]
	</update>
	
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*) FROM REVIEW_BOARD WHERE R_STATUS_YN = 'Y'
	</select>
	
	<select id="selectReviewByNo" resultMap="ReviewResultMap">
		SELECT * FROM REVIEW_BOARD WHERE REVIEW_NO = #{reviewNo } AND R_STATUS_YN = 'Y'
	</select>
	
	<select id="selectReviewByList" resultMap="ReviewResultMap">
		SELECT * FROM REVIEW_BOARD WHERE R_STATUS_YN = 'Y' ORDER BY REVIEW_NO DESC
	</select>
	
	<select id="selectReviewByKeyword" resultMap="ReviewResultMap">
	 	SELECT * FROM REVIEW_BOARD
	 	<if test="searchCondition == 'all'">
	 	WHERE REVIEW_TITLE LIKE'%'||#{searchKeyword }||'%' OR REVIEW_TITLE LIKE '%'||#{searchKeyword }||'%' OR REVIEW_CONTENT LIKE'%'||#{searchKeyword }||'%' OR R_USER_ID LIKE '%'||#{searchKeyword }||'%'
	 	</if>
	 	<if test="searchCondition == 'title'">
	 	WHERE REVIEW_TITLE LIKE'%'||#{searchKeyword }||'%'
	 	</if>
	 	<if test="searchCondition == 'content'">
	 	WHERE REVIEW_CONTENT LIKE'%'||#{searchKeyword }||'%'
	 	</if>
	 	<if test="searchCondition == 'writer'">
	 	WHERE R_USER_ID LIKE '%'||#{searchKeyword }||'%'
	 	</if>
	</select>
	
	<select id="selectReviewByKeywordCount" resultMap="ReviewResultMap">
		SELECT COUNT(*) FROM REVIEW_BOARD
		<if test="searchCondition == 'all'">
		WHERE REVIEW_TITLE LIKE'%'||#{searchKeyword }||'%' OR REVIEW_TITLE LIKE '%'||#{searchKeyword }||'%' OR REVIEW_CONTENT LIKE'%'||#{searchKeyword }||'%' OR R_USER_ID LIKE '%'||#{searchKeyword }||'%'
		</if>
		<if test="searchCondition == 'title'">
		WHERE REVIEW_TITLE LIKE'%'||#{searchKeyword }||'%'
		</if>
		<if test="searchCondition == 'content'">
		WHERE REVIEW_CONTENT LIKE'%'||#{searchKeyword }||'%'
		</if>
		<if test="searchCondition == 'writer'">
		WHERE R_USER_ID LIKE '%'||#{searchKeyword }||'%'
		</if>
	</select>
	
	<!-- 마이페이지 - 게시글 목록 조회 -->
	<select id="selectReviewList" resultMap="ReviewResultMap">
		SELECT * FROM REVIEW_BOARD WHERE R_USER_ID = #{ userId } ORDER BY REVIEW_NO DESC
	</select>
	
	<!-- 마이페이지 - 게시글 전체 갯수 조회 -->
	<select id="selectBoardCount" resultType="_int">
		SELECT COUNT(*) FROM REVIEW_BOARD WHERE R_USER_ID = #{ userId } AND R_STATUS_YN = 'Y'
	</select>
</mapper>
